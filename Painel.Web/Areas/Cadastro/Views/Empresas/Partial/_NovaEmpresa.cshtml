@model Painel.Web.Areas.Cadastro.Models.EmpresasViewModel

<link href="~/Contents/plugins/sweetalert/sweetalert2.min.css" rel="stylesheet" />
@*<link href="~/Areas/Cadastro/Contents/css/empresas.css" rel="stylesheet" />*@
<link href="~/Contents/plugins/pace/pace.css" rel="stylesheet" />
<link href="~/Contents/css/jquery.fancybox.css" rel="stylesheet" />



@using (Html.BeginForm("InserirEmpresa", "Empresas", FormMethod.Post))
{

    <section class="content">
        <div class="col-lg-12 col-xs-12">
            <div class="box box-success box-solid">
                <div class="box-body">
                    <div class="col-lg-12">
                        @Html.AntiForgeryToken()
                        @Html.HiddenFor(model => model.id)

                        <div id="divLoader" style="display:none;">
                            <img src="~/Contents/img/loading.gif" alt="Loader" />
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.CNPJ)
                                @Html.TextBoxFor(model => model.CNPJ, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.CNPJ, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.RAZAOSOCIAL)
                                @Html.TextBoxFor(model => model.RAZAOSOCIAL, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.RAZAOSOCIAL, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.NOMEFANTASIA)
                                @Html.TextBoxFor(model => model.NOMEFANTASIA, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.NOMEFANTASIA, "", new { @class = "text-danger" })
                                <br />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.INSCRICAOESTADUAL)
                                @Html.TextBoxFor(model => model.INSCRICAOESTADUAL, new { @class = "form-control" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.ISS)
                                @Html.TextBoxFor(model => model.ISS, new { @class = "form-control" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.EMAIL)
                                @Html.TextBoxFor(model => model.EMAIL, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.EMAIL, "", new { @class = "text-danger" })
                                <br />
                            </div>
                        </div>
                        <div class="row pnendereco">
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.CEP)
                                @Html.TextBoxFor(model => model.CEP, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.CEP, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.ENDERECO)
                                @Html.TextBoxFor(model => model.ENDERECO, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.ENDERECO, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.NUMERO)
                                @Html.TextBoxFor(model => model.NUMERO, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.NUMERO, "", new { @class = "text-danger" })
                                <br />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.BAIRRO)
                                @Html.TextBoxFor(model => model.BAIRRO, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.BAIRRO, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.COMPLEMENTO)
                                @Html.TextBoxFor(model => model.COMPLEMENTO, new { @class = "form-control" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.UF)
                                @Html.DropDownListFor(model => model.idUF, new SelectList(ViewBag.Uf, "value", "text", (Model != null) ? Model.UF : default(string)), "Selecione...", new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.UF, "", new { @class = "text-danger" })
                                <br />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.CIDADE)
                                @Html.TextBoxFor(model => model.CIDADE, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.CIDADE, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.TELEFONE)
                                @Html.TextBoxFor(model => model.TELEFONE, new { @class = "form-control" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.TELEFONE2)
                                @Html.TextBoxFor(model => model.TELEFONE2, new { @class = "form-control" })
                                <br />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.REPRESENTANTELEGAL)
                                @Html.TextBoxFor(model => model.REPRESENTANTELEGAL, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.REPRESENTANTELEGAL, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.CPFREPRESENTANTE)
                                @Html.TextBoxFor(model => model.CPFREPRESENTANTE, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.CPFREPRESENTANTE, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.RGREPRESENTANTE)
                                @Html.TextBoxFor(model => model.RGREPRESENTANTE, new { @class = "form-control" })
                                @Html.ValidationMessageFor(model => model.RGREPRESENTANTE, "", new { @class = "text-danger" })

                                <br />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                @Html.LabelFor(model => model.CONTATO)
                                @Html.TextBoxFor(model => model.CONTATO, new { @class = "form-control" })
                            </div>
                            <div class="col-md-4 mb-3">
                                @if (ViewBag.ativo == "Nao")
                                {
                                    @Html.LabelFor(model => model.STATUS)
                                    <select name="STATUS" class="form-control">
                                        <option value="Nao">Não</option>
                                        <option value="Sim">Sim</option>
                                    </select>
                                    <br />
                                }
                                else
                                {
                                    @Html.LabelFor(model => model.STATUS)
                                    <select name="STATUS" class="form-control">
                                        <option value="Sim">Sim</option>
                                        <option value="Nao">Não</option>
                                    </select>
                                    <br />
                                }
                            </div>
                        </div>
                        <div class="row">

                        </div>
                        <div class="col-md-12" align="center">
                            <button type="submit" class="btn btn-success btn-lg btn-block">
                                <i class="fa fa-floppy-o"></i> Salvar Cadastro
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
}


<script src="~/Contents/js/jquery.mask.min.js"></script>
<script src="~/Contents/plugins/pace/pace.min.js"></script>
<script src="~/Contents/js/jquerydownloader.min.js"></script>
<script src="~/Contents/js/jquery.fancybox.js"></script>
<script src="~/Contents/plugins/block-ui/jquery.blockUI.min.js"></script>
<script>
    if (window.jQuery) {
        $(function () {
            $('#CNPJ').mask('00.000.000/0000-00', { clearIfNotMatch: true });
            $('#CPFREPRESENTANTE').mask('000.000.000-00', { clearIfNotMatch: true });
            $('#CEP').mask('00000-000', { clearIfNotMatch: true });
            $('#TELEFONE').mask('(00)0000-0000', { clearIfNotMatch: true });
            $('#TELEFONE2').mask('(00)00000-0000', { clearIfNotMatch: true });

            $(document).on("blur keyup", "#CNPJ", function () {
                if ($(this).val().length == 18) {
                    $("#RAZAOSOCIAL").focus();
                    if ($(this).val().length == 18) {
                        $.post("@Url.Action("ValidaCNPJ", "Empresas")", { cnpj: $("#CNPJ").val() }, function (data) {
                            if (data.cnpj == "F") {
                                swal({
                                    title: "Erro",
                                    text: "CNPJ não é válido",
                                    type: "warning",
                                    onClose: () => {
                                    }
                                });
                                var cnpj = "";
                                $("#CNPJ").val(cnpj);
                                $("#RAZAOSOCIAL").focus();
                            }
                            @*else {
                                $.post("@Url.Action("BuscaEmpresa", "Empresas")", { cnpj: $("#CNPJ").val() }, function (data) {
                                    if (data.busca == "F") {
                                        swal({
                                            title: "Erro",
                                            text: "CNPJ já foi cadastrado",
                                            type: "warning",
                                            onClose: () => {
                                            }
                                        });
                                        var cnpj = "";
                                        $("#CNPJ").val(cnpj);
                                        $("#RAZAOSOCIAL").focus();
                                    }
                                 });
                            }*@
                        });
                    }
                }
            });


            $(document).on("blur keyup", "#CPFREPRESENTANTE", function () {
                if ($(this).val().length == 14) {
                    $.post("@Url.Action("ValidaCPFRep", "Empresas")", { cpf: $("#CPFREPRESENTANTE").val() }, function (data) {
                        $.fancybox.showLoading();
                        if (data.cpf == "F") {
                            swal({
                                title: "Erro",
                                text: "CPF não é válido",
                                type: "warning",
                                onClose: () => {
                                }
                            });
                            var cpfrep = "";
                            $("#CPFREPRESENTANTE").val(cpfrep);
                        }

                        $.fancybox.hideLoading();
                    });
                }
            });

             $(document).on("blur keyup", "#CEP", function () {
                 if ($(this).val().length == 9) {
                      $.fancybox.showLoading();
                     //$("#ENDERECO").focus();

                    $.post("@Url.Action("BuscaCep", "Empresas")", { cep: $("#CEP").val() }, function (data) {
                        if (data != false) {
                            $("#ENDERECO").val(data.end);
                            $("#CIDADE").val(data.cidade);
                            $("#COMPLEMENTO").val(data.complemento);
                            $("#idUF").val(data.uf);
                            $("#BAIRRO").val(data.bairro);
                        }

                      $.fancybox.hideLoading();
                    });
                }
            });

        });
    }
</script>
